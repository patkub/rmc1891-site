<!--
@license
Copyright (c) 2017 Rogers Manufacturing Company. All rights reserved.
-->

<!-- Polymer -->
<link rel="import" href="../../node_modules/@npm-polymer/polymer/polymer-element.html">

<!-- Iron Ajax -->
<link rel="import" href="../../node_modules/@npm-polymer/iron-ajax/iron-ajax.html">

<dom-module id="view-contact">
    <template>
        <!-- container -->
        <div class="container">
                
            <h2>Contact</h2>
            
            <!-- iron ajax request to send email -->
            <iron-ajax
                id="email"
                url="php/mail.php"
                handle-as="json"
                method="POST">
            </iron-ajax>
            
            <form id="emailForm" action="javascript:void(0);">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input name="email" type="email" class="form-control" aria-describedby="email" placeholder="Your email" value="{{email::input}}">
                </div>
                
                <div class="form-group">
                    <label for="subject">Subject</label>
                    <input name="subject" type="text" class="form-control" aria-describedby="subject" value="{{subject::input}}">
                </div>
                
                <div class="form-group">
                    <label for="message">Message</label>
                    <textarea class="form-control" name="message" rows="20" value="{{message::input}}"></textarea>
                </div>
                
                <button name="submit" type="submit" class="btn btn-primary" on-tap="_sendEmail" email$="{{email}}" subject$="{{subject}}" message$="{{message}}">Submit</button>
            </form>
            
            <br>

        </div>
        <!-- /container -->
    </template>

    <script>
        /* eslint new-cap: ["error", { "capIsNew": false }] */
        
        class ViewContact extends
              Polymer.GestureEventListeners(Polymer.Element) {
            static get is() {return 'view-contact';}
            
            /**
             * Send email
             *
             * @param {Object} e - on-tap event, 'machine' attribute is the machine to add.
             */
            _sendEmail(e) {
               // get email
               var email = e.target.getAttribute('email');
               var subject = e.target.getAttribute('subject');
               var message = e.target.getAttribute('message');
               
               // send the email
               var params = 'email=' + email + '&subject=' + subject + '&message=' + message;
               var xhr = this.shadowRoot.getElementById('email');
               xhr.body = params;
               xhr.generateRequest();
               
               // reset the form
               this.shadowRoot.getElementById('emailForm').reset();
            }
        }
        window.customElements.define(ViewContact.is, ViewContact);
    </script>
</dom-module>
